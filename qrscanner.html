<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta name="description" content="Scan QR codes instantly with NexQR's online QR scanner. Fast, secure, and easy QR code scanning for everyone.">
    <meta name="keywords" content="QR scanner, scan QR code, NexQR, online QR scanner, QR code reader, fast QR scan">
    <meta name="author" content="NexQR Team">
    <title>NexQR - QR Scanner</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .scanner-container {
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .scanner-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.15);
        }
        .scan-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, rgba(102, 126, 234, 0) 0%, #667eea 50%, rgba(102, 126, 234, 0) 100%);
            animation: scan 2s linear infinite;
            z-index: 10;
        }
        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }
        .scanner-frame {
            position: absolute;
            border: 4px solid #667eea;
            border-radius: 8px;
            width: 70%;
            height: 70%;
            top: 15%;
            left: 15%;
            z-index: 5;
            box-shadow: 0 0 0 10000px rgba(0, 0, 0, 0.5);
        }
        .result-card {
            transition: all 0.3s ease;
            max-height: 0;
            overflow: hidden;
        }
        .result-card.active {
            max-height: 500px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        .history-item {
            transition: all 0.2s ease;
        }
        .history-item:hover {
            transform: translateX(5px);
            background-color: rgba(102, 126, 234, 0.1);
        }
        .mobile-menu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .mobile-menu.open {
            max-height: 500px;
        }
        .feature-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body class="text-gray-800">
    <!-- Navbar/Header -->
    <header class="gradient-bg text-white sticky top-0 z-50 shadow-md">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <i class="fas fa-qrcode text-3xl mr-2"></i>
                    <h1 class="text-2xl font-bold">NexQR</h1>
                </div>
                <nav class="hidden md:block">
                    <ul class="flex space-x-8 items-center">
                        <li><a href="index.html" class="hover:text-gray-200 transition font-medium">Home</a></li>

                        <li class="relative group">
                            <a href="#" class="hover:text-gray-200 transition font-medium flex items-center">
                                Features <i class="fas fa-chevron-down ml-1 text-sm"></i>
                            </a>
                            <div class="absolute left-0 mt-2 w-48 gradient-bg rounded-md shadow-lg py-2 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                                <a href="logoqr.html" class="block px-4 py-2 text-white hover:bg-indigo-700">Logo QR</a>
                                <a href="imageqr.html" class="block px-4 py-2 text-white hover:bg-indigo-700">Image QR</a>
                                <a href="microqr.html" class="block px-4 py-2 text-white hover:bg-indigo-700">Micro QR</a>
                                <a href="rmqr.html" class="block px-4 py-2 text-white hover:bg-indigo-700">rMQR</a>
                                <a href="qrscanner.html"  class="block px-4 py-2 text-white hover:bg-indigo-700">QR Scanner</a>
                                <a href="barcode.html" class="block px-4 py-2 text-white hover:bg-indigo-700">Barcode</a>
                            </div>
                        </li>
                        <li><a href="#how-it-works" class="hover:text-gray-200 transition font-medium">How It Works</a></li>
                        <li><a href="#testimonials" class="hover:text-gray-200 transition font-medium">Testimonials</a></li>
                    </ul>
                </nav>
                <button id="mobile-menu-button" class="md:hidden text-xl focus:outline-none">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            <!-- Mobile menu -->
            <div id="mobile-menu" class="mobile-menu md:hidden">
                <ul class="py-4 space-y-3">
                    <li><a href="#" class="block hover:text-gray-200 transition">Home</a></li>
                    <li class="pt-2">
                        <span class="text-gray-300 block mb-2">Features</span>
                        <div class="grid grid-cols-2 gap-2 pl-4 gradient-bg rounded-md">
                                <a href="logoqr.html" class="block px-4 py-2 text-white hover:bg-indigo-700">Logo QR</a>
                                <a href="imageqr.html" class="block px-4 py-2 text-white hover:bg-indigo-700">Image QR</a>
                                <a href="microqr.html" class="block px-4 py-2 text-white hover:bg-indigo-700">Micro QR</a>
                                <a href="rmqr.html" class="block px-4 py-2 text-white hover:bg-indigo-700">rMQR</a>
                                <a href="qrscanner.html"  class="block px-4 py-2 text-white hover:bg-indigo-700">QR Scanner</a>
                                <a href="barcode.html" class="block px-4 py-2 text-white hover:bg-indigo-700">Barcode</a>
                        </div>
                    </li>
                    <li><a href="#how-it-works" class="block hover:text-gray-200 transition">How It Works</a></li>
                    <li><a href="#testimonials" class="block hover:text-gray-200 transition">Testimonials</a></li>
                </ul>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12">
        <div class="text-center mb-12">
            <h2 class="text-4xl font-bold mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent;">QR Code Scanner</h2>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">Scan any QR code with your device's camera. Our scanner works with all standard QR code formats.</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Scanner Section -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl p-6 scanner-container">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-semibold">Camera Scanner</h3>
                        <div class="flex space-x-2">
                            <button id="switch-camera" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg transition">
                                <i class="fas fa-sync-alt mr-2"></i> Switch Camera
                            </button>
                            <button id="toggle-flash" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg transition">
                                <i class="fas fa-lightbulb mr-2"></i> Flash
                            </button>
                        </div>
                    </div>
                    
                    <div class="relative overflow-hidden rounded-lg bg-black aspect-square">
                        <video id="scanner-video" class="w-full h-full object-cover" muted playsinline></video>
                        <div class="scanner-frame"></div>
                        <div class="scan-animation"></div>
                        <div id="scanner-loading" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-70 text-white">
                            <div class="text-center">
                                <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                                <p>Initializing scanner...</p>
                                <p class="text-sm text-gray-300 mt-2">Please allow camera access</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <p class="text-center text-gray-600 mb-4">- OR -</p>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button id="upload-btn" class="flex-1 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-4 py-3 rounded-lg transition font-medium">
                                <i class="fas fa-upload mr-2"></i> Upload Image
                            </button>
                            <input type="file" id="file-input" accept="image/*" class="hidden">
                            <button id="paste-btn" class="flex-1 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-4 py-3 rounded-lg transition font-medium">
                                <i class="fas fa-paste mr-2"></i> Paste from Clipboard
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Result Section -->
                <div id="result-card" class="result-card bg-white rounded-xl mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Scan Result</h3>
                        <div class="flex space-x-2">
                            <button id="copy-result" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-1 rounded-lg text-sm transition">
                                <i class="fas fa-copy mr-1"></i> Copy
                            </button>
                            <button id="clear-result" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-1 rounded-lg text-sm transition">
                                <i class="fas fa-times mr-1"></i> Clear
                            </button>
                        </div>
                    </div>
                    <div id="result-content" class="bg-gray-50 p-4 rounded-lg overflow-auto max-h-60">
                        <p class="text-gray-500 italic">No QR code scanned yet</p>
                    </div>
                    <div id="result-actions" class="mt-4 flex flex-wrap gap-2 hidden">
                        <a id="open-url" href="#" target="_blank" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition">
                            <i class="fas fa-external-link-alt mr-2"></i> Open URL
                        </a>
                        <button id="share-result" class="bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-4 py-2 rounded-lg transition">
                            <i class="fas fa-share-alt mr-2"></i> Share
                        </button>
                        <button id="save-history" class="bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-4 py-2 rounded-lg transition">
                            <i class="fas fa-save mr-2"></i> Save to History
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- History Section -->
            <div>
                <div class="bg-white rounded-xl p-6 h-full">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-semibold">Scan History</h3>
                        <button id="clear-history" class="text-gray-500 hover:text-gray-700 transition">
                            <i class="fas fa-trash-alt mr-1"></i> Clear All
                        </button>
                    </div>
                    
                    <div id="history-list" class="space-y-3 max-h-[600px] overflow-y-auto pr-2">
                        <div class="text-center py-8">
                            <i class="fas fa-history text-4xl text-gray-300 mb-3"></i>
                            <p class="text-gray-500">Your scan history will appear here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Features Section -->
    <section id="features" class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold mb-4">Advanced Scanner Features</h2>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">Our scanner goes beyond basic QR code reading with these powerful features</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition">
                    <div class="feature-icon gradient-bg text-white mx-auto">
                        <i class="fas fa-bolt text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-center mb-3">Lightning Fast</h3>
                    <p class="text-gray-600 text-center">Our optimized scanning algorithm detects QR codes in milliseconds, even in low light conditions.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition">
                    <div class="feature-icon gradient-bg text-white mx-auto">
                        <i class="fas fa-shield-alt text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-center mb-3">Secure Scanning</h3>
                    <p class="text-gray-600 text-center">All scanning happens in your browser. No data is sent to our servers, ensuring complete privacy.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition">
                    <div class="feature-icon gradient-bg text-white mx-auto">
                        <i class="fas fa-file-image text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-center mb-3">Multiple Formats</h3>
                    <p class="text-gray-600 text-center">Supports all QR code variants including Micro QR, rMQR, and even reads barcodes from images.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <div class="flex items-center mb-4">
                        <i class="fas fa-qrcode text-2xl mr-2 text-indigo-400"></i>
                        <h2 class="text-xl font-bold">NexQR</h2>
                    </div>
                    <p class="text-gray-400">The most advanced QR code generator and scanner on the web. Free forever.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Features</h3>
                    <ul class="space-y-2">
                        <li><a href="logoqr.html" class="text-gray-400 hover:text-white transition">Logo QR</a></li>
                        <li><a href="#generator" class="text-gray-400 hover:text-white transition">Color QR</a></li>
                        <li><a href="#generator" class="text-gray-400 hover:text-white transition">Shape QR</a></li>
                        <li><a href="imageqr.html" class="text-gray-400 hover:text-white transition">Image QR</a></li>
                        <li><a href="barcode.html" class="text-gray-400 hover:text-white transition">Barcode</a></li>
  </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Resources</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Blog</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Tutorials</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">API</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Help Center</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Company</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">About Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Contact</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Privacy Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="pt-8 border-t border-gray-800 flex flex-col md:flex-row justify-between items-center">
                <div class="text-gray-400 text-sm mb-4 md:mb-0">
                    <p>&copy; 2025 NexQR. All rights reserved.</p>
                </div>
                <div class="flex space-x-6">
                    <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-twitter text-xl"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-facebook text-xl"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-instagram text-xl"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-github text-xl"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('open');
        });

        // QR Scanner functionality
        const video = document.getElementById('scanner-video');
        const loadingElement = document.getElementById('scanner-loading');
        const resultCard = document.getElementById('result-card');
        const resultContent = document.getElementById('result-content');
        const resultActions = document.getElementById('result-actions');
        const openUrlBtn = document.getElementById('open-url');
        const copyResultBtn = document.getElementById('copy-result');
        const clearResultBtn = document.getElementById('clear-result');
        const shareResultBtn = document.getElementById('share-result');
        const saveHistoryBtn = document.getElementById('save-history');
        const historyList = document.getElementById('history-list');
        const clearHistoryBtn = document.getElementById('clear-history');
        const uploadBtn = document.getElementById('upload-btn');
        const fileInput = document.getElementById('file-input');
        const pasteBtn = document.getElementById('paste-btn');
        const switchCameraBtn = document.getElementById('switch-camera');
        const toggleFlashBtn = document.getElementById('toggle-flash');

        let currentStream = null;
        let facingMode = "environment"; // Default to rear camera
        let flashOn = false;
        let scanHistory = JSON.parse(localStorage.getItem('qrScanHistory')) || [];
        let lastScanTime = 0;

        // Initialize scanner
        function initScanner() {
            stopScanner();
            
            const constraints = {
                video: {
                    facingMode: facingMode,
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }
            };

            navigator.mediaDevices.getUserMedia(constraints)
                .then(function(stream) {
                    currentStream = stream;
                    video.srcObject = stream;
                    video.play();
                    
                    // Hide loading after video starts playing
                    video.onplaying = function() {
                        loadingElement.style.display = 'none';
                        scanQRCode();
                    };
                })
                .catch(function(err) {
                    console.error("Error accessing camera:", err);
                    loadingElement.innerHTML = `
                        <div class="text-center">
                            <i class="fas fa-exclamation-triangle text-4xl mb-4 text-red-400"></i>
                            <p>Camera access denied</p>
                            <p class="text-sm text-gray-300 mt-2">Please enable camera permissions to use the scanner</p>
                            <button onclick="initScanner()" class="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition">
                                <i class="fas fa-redo mr-2"></i> Try Again
                            </button>
                        </div>
                    `;
                });
        }

        // Stop scanner and release camera
        function stopScanner() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
        }

        // Scan QR code from video stream
        function scanQRCode() {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            function scanFrame() {
                if (video.readyState === video.HAVE_ENOUGH_DATA) {
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: "dontInvert",
                    });
                    
                    if (code) {
                        const now = Date.now();
                        if (now - lastScanTime > 2000) { // Throttle scans to 1 every 2 seconds
                            lastScanTime = now;
                            displayResult(code.data);
                        }
                    }
                }
                requestAnimationFrame(scanFrame);
            }
            
            requestAnimationFrame(scanFrame);
        }

        // Display scan result
        function displayResult(data) {
            resultCard.classList.add('active');
            
            // Check if data is a URL
            const isUrl = /^https?:\/\//i.test(data);
            
            if (isUrl) {
                resultContent.innerHTML = `<p class="text-blue-600 break-all">${data}</p>`;
                openUrlBtn.href = data;
                openUrlBtn.classList.remove('hidden');
            } else {
                resultContent.innerHTML = `<p class="break-all">${data}</p>`;
                openUrlBtn.classList.add('hidden');
            }
            
            resultActions.classList.remove('hidden');
        }

        // Copy result to clipboard
        copyResultBtn.addEventListener('click', function() {
            const text = resultContent.textContent.trim();
            navigator.clipboard.writeText(text).then(() => {
                const originalText = copyResultBtn.innerHTML;
                copyResultBtn.innerHTML = '<i class="fas fa-check mr-1"></i> Copied!';
                setTimeout(() => {
                    copyResultBtn.innerHTML = originalText;
                }, 2000);
            });
        });

        // Clear result
        clearResultBtn.addEventListener('click', function() {
            resultCard.classList.remove('active');
            resultActions.classList.add('hidden');
        });

        // Share result
        shareResultBtn.addEventListener('click', function() {
            const text = resultContent.textContent.trim();
            if (navigator.share) {
                navigator.share({
                    title: 'QR Code Scan Result',
                    text: text,
                    url: text.startsWith('http') ? text : undefined
                }).catch(err => {
                    console.log('Error sharing:', err);
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(text).then(() => {
                    alert('Scan result copied to clipboard');
                });
            }
        });

        // Save to history
        saveHistoryBtn.addEventListener('click', function() {
            const text = resultContent.textContent.trim();
            const timestamp = new Date().toLocaleString();
            const isUrl = /^https?:\/\//i.test(text);
            
            const scanItem = {
                id: Date.now(),
                content: text,
                timestamp: timestamp,
                isUrl: isUrl
            };
            
            scanHistory.unshift(scanItem);
            updateLocalStorage();
            renderHistory();
            
            saveHistoryBtn.innerHTML = '<i class="fas fa-check mr-2"></i> Saved!';
            setTimeout(() => {
                saveHistoryBtn.innerHTML = '<i class="fas fa-save mr-2"></i> Save to History';
            }, 2000);
        });

        // Clear history
        clearHistoryBtn.addEventListener('click', function() {
            if (scanHistory.length > 0 && confirm('Are you sure you want to clear all scan history?')) {
                scanHistory = [];
                updateLocalStorage();
                renderHistory();
            }
        });

        // Upload image to scan
        uploadBtn.addEventListener('click', function() {
            fileInput.click();
        });

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    context.drawImage(img, 0, 0, canvas.width, canvas.height);
                    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: "dontInvert",
                    });
                    
                    if (code) {
                        displayResult(code.data);
                    } else {
                        resultCard.classList.add('active');
                        resultContent.innerHTML = '<p class="text-red-500">No QR code found in this image</p>';
                        resultActions.classList.add('hidden');
                    }
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
            fileInput.value = '';
        });

        // Paste from clipboard
        pasteBtn.addEventListener('click', async function() {
            try {
                const clipboardItems = await navigator.clipboard.read();
                for (const clipboardItem of clipboardItems) {
                    for (const type of clipboardItem.types) {
                        if (type.startsWith('image/')) {
                            const blob = await clipboardItem.getType(type);
                            const img = new Image();
                            img.onload = function() {
                                const canvas = document.createElement('canvas');
                                const context = canvas.getContext('2d');
                                canvas.width = img.width;
                                canvas.height = img.height;
                                context.drawImage(img, 0, 0, canvas.width, canvas.height);
                                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                                const code = jsQR(imageData.data, imageData.width, imageData.height, {
                                    inversionAttempts: "dontInvert",
                                });
                                
                                if (code) {
                                    displayResult(code.data);
                                } else {
                                    resultCard.classList.add('active');
                                    resultContent.innerHTML = '<p class="text-red-500">No QR code found in the pasted image</p>';
                                    resultActions.classList.add('hidden');
                                }
                            };
                            img.src = URL.createObjectURL(blob);
                            return;
                        }
                    }
                }
                alert('No image found in clipboard');
            } catch (err) {
                console.error('Failed to read clipboard:', err);
                alert('Failed to access clipboard. Make sure you have granted clipboard permissions.');
            }
        });

        // Switch between front and back camera
        switchCameraBtn.addEventListener('click', function() {
            facingMode = facingMode === "user" ? "environment" : "user";
            initScanner();
        });

        // Toggle flash (if available)
        toggleFlashBtn.addEventListener('click', function() {
            if (!currentStream) return;
            
            const videoTrack = currentStream.getVideoTracks()[0];
            if (videoTrack && typeof videoTrack.getCapabilities === 'function') {
                const capabilities = videoTrack.getCapabilities();
                if (capabilities.torch) {
                    flashOn = !flashOn;
                    videoTrack.applyConstraints({
                        advanced: [{ torch: flashOn }]
                    }).then(() => {
                        toggleFlashBtn.innerHTML = flashOn 
                            ? '<i class="fas fa-lightbulb mr-2"></i> Flash On' 
                            : '<i class="far fa-lightbulb mr-2"></i> Flash Off';
                    }).catch(err => {
                        console.error('Error toggling flash:', err);
                    });
                } else {
                    alert('Flash not supported by this device');
                }
            } else {
                alert('Flash not supported by this browser');
            }
        });

        // Update localStorage with scan history
        function updateLocalStorage() {
            localStorage.setItem('qrScanHistory', JSON.stringify(scanHistory));
        }

        // Render scan history
        function renderHistory() {
            if (scanHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-history text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500">Your scan history will appear here</p>
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = scanHistory.map(item => `
                <div class="history-item bg-gray-50 p-4 rounded-lg cursor-pointer" data-id="${item.id}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1 min-w-0">
                            <p class="text-sm text-gray-500 mb-1">${item.timestamp}</p>
                            <p class="font-medium truncate ${item.isUrl ? 'text-blue-600' : ''}">${item.content}</p>
                        </div>
                        <button class="delete-item text-gray-400 hover:text-red-500 ml-2">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Add event listeners to history items
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('delete-item') && !e.target.closest('.delete-item')) {
                        const id = parseInt(this.getAttribute('data-id'));
                        const historyItem = scanHistory.find(item => item.id === id);
                        if (historyItem) {
                            displayResult(historyItem.content);
                        }
                    }
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-item').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const id = parseInt(this.closest('.history-item').getAttribute('data-id'));
                    scanHistory = scanHistory.filter(item => item.id !== id);
                    updateLocalStorage();
                    renderHistory();
                });
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initScanner();
            renderHistory();
            
            // Pause scanner when tab is not active
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    stopScanner();
                } else {
                    initScanner();
                }
            });
        });
    </script>
</body>
</html>